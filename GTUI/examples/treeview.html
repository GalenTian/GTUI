<!DOCTYPE html>
<html>
<head>
    <title>Tree</title>
    <meta charset="utf-8" />

    <link type="text/css" rel="stylesheet" href="../dist/css/gtui.css" />
</head>
<body ng-app="GTUIComponent">
    <div>
        <h1>Tree View</h1>
        <div ng-controller="DemoController as dc">
            <div id="demo-tree"></div>
        </div>
    </div>

    <script src="lib/jquery-1.9.0.js"></script>
    <script src="lib/jquery-ui-1.9.2.js"></script>
    <script src="lib/angular-1.28.js"></script>
    <script src="../dist/js/gtui.js"></script>
    <script type="text/javascript">

        var MyPagerController = function ($scope) {
            var vm = this;

            return vm;
        };

        // Page Controller
        angular.module('GTUIComponent', ['gtui'])
            // Controllers for Tables
            .controller('DemoController', MyPagerController);

        var data = [
            {
                DepartmentID: 'DEP000000001',
                LongName: 'Level 1',
                ShortName: 'LV1',
                state: {
                    checked: false
                },
                nodes: [
                    {
                        DepartmentID: 'DEP000000011',
                        LongName: 'Level 1-1',
                        ShortName: 'LV1-1',
                        state: {
                            checked: false
                        },
                        nodes: [
                            {
                                DepartmentID: 'DEP000000111',
                                LongName: 'Level 1-1-1',
                                ShortName: 'LV1-1-1'
                            },
                            {
                                DepartmentID: 'DEP000000112',
                                LongName: 'Level 1-1-1',
                                ShortName: 'LV1-1-1'
                            }
                        ]
                    },
                    {
                        DepartmentID: 'DEP000000012',
                        LongName: 'Level 1-2',
                        ShortName: 'LV1-2',
                        state: {
                            checked: true
                        }
                    }
                ]
            },
            {
                DepartmentID: 'DEP000000002',
                LongName: 'Level 1',
                ShortName: 'LV1',
                state: {
                    checked: true
                }
            }

        ];

        var checked;

        var setText = function (data) {
            for (var i = 0, length = data.length; i < length; i++) {
                var dataItem = data[i];
                dataItem.text = dataItem.LongName + ' (' + dataItem.ShortName + ')';

                if (dataItem.nodes) {
                    setText(dataItem.nodes);
                }
            }
        };

        setText(data);

        var getChildNodesId = function (nodes) {
            var ids = [];

            for (var i = 0, length = nodes.length; i < length; i++) {
                var node = nodes[i];

                ids.push(node.nodeId);

                if (node.nodes) {
                    ids.concat(getChildNodesId(node.nodes));
                }
            }

            return ids;
        };
        var getParentNodesId = function (node, el) {
            var ids = [],
                id = node.parentId;

            if (id > -1) ids.push(id);

            var parentNode = el.treeview('getNode', id);

            if (parentNode.parentId > -1) ids.concat(getParentNodesId(parentNode, el));

            return ids;
        };
        var allSiblingsChecked = function (node, el) {

        };

        $(function () {
            $('#demo-tree').treeview({
                showIcon: false,
                showCheckbox: true,
                onNodeChecked: function (e, node) {
                    if (node.nodes) {
                        $(e.target).treeview('checkNode', [getChildNodesId(node.nodes), { silence: true }]);
                        checkParentChecking(node, $(e.target));
                    }
                },
                onNodeUnchecked: function (e, node) {
                    if (node.nodes) {
                        $(e.target).treeview('uncheckNode', [getChildNodesId(node.nodes), { silent: true }]);
                        $(e.target).treeview('uncheckNode', [getParentNodesId(node, $(e.target)), { silent: true }]);
                    }
                },
                data: data
            });
        });
    </script>
</body>
</html>
